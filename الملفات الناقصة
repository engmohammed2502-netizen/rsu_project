touch library/__init__.py
touch management/__init__.py




ملف .env

DEBUG=True
SECRET_KEY='django-insecure-put-your-long-secret-key-here'
# إعدادات قاعدة البيانات
DB_NAME=postgres
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=db
DB_PORT=5432





انشاء حساب الroot 



sudo docker-compose exec web python manage.py createsuperuser


سيطلب منك النظام:
​Username: (اكتب مثلاً admin واضغط Enter).
​Email: (يمكنك تركه فارغاً أو كتابة إيميلك).
​Password: (اكتب كلمة مرور قوية، لن تظهر الحروف أثناء الكتابة وهذا طبيعي لدواعي الأمان، اكتبها واضغط Enter).
​كرر كلمة المرور.
​بعدها، اذهب للمتصفح واكتب: http://192.168.111.129:8080/admin (أو استخدم IP الويندوز إذا كنت من جهاز آخر). ستظهر لك لوحة تحكم Django الجاهزة!



اعدادات ملف الضبط

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'library',  # <--- أضف هذا السطر هنا
]





# --- إعدادات اللغة والتوقيت ---
LANGUAGE_CODE = 'ar'
TIME_ZONE = 'Africa/Khartoum' 
USE_I18N = True
USE_TZ = True

# --- تعريف نموذج المستخدم المخصص ---
AUTH_USER_MODEL = 'library.User'

# --- إعدادات الملفات (150 ميقا كحد أقصى) ---
DATA_UPLOAD_MAX_MEMORY_SIZE = 157286400  # 150 MB
FILE_UPLOAD_MAX_MEMORY_SIZE = 157286400  # 150 MB

# --- إعدادات الجلسة (للزوار 30 دقيقة) ---
SESSION_COOKIE_AGE = 1800  # 30 minutes
SESSION_EXPIRE_AT_BROWSER_CLOSE = True

# --- إعدادات تسجيل الدخول ---
LOGIN_URL = 'login'
LOGIN_REDIRECT_URL = 'home'
LOGOUT_REDIRECT_URL = 'login'

# تحذير: هذا سيمسح البيانات القديمة وهو ضروري في هذه المرحلة
sudo docker-compose exec db psql -U postgres -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"






sudo docker-compose exec web python manage.py makemigrations library




sudo docker-compose exec web python manage.py migrate




sudo docker-compose exec web python manage.py createsuperuser











@login_required
def add_user_view(request):
    # مسموح فقط للـ Root (Zero) بإضافة مستخدمين
    if request.user.user_type != 'ROOT':
        return redirect('home')
        
    if request.method == 'POST':
        full_name = request.POST.get('full_name')
        username = request.POST.get('username') # الرقم الجامعي
        password = request.POST.get('password')
        user_type = request.POST.get('user_type') # STUDENT أو ADMIN
        
        if User.objects.filter(username=username).exists():
            messages.error(request, 'هذا الرقم الجامعي مسجل مسبقاً!')
        else:
            new_user = User.objects.create_user(
                username=username, 
                password=password,
                full_name=full_name,
                user_type=user_type
            )
            log_activity(request.user, f"إضافة مستخدم جديد: {username}", request)
            messages.success(request, f'تم إضافة {full_name} بنجاح')
            return redirect('root_dashboard')
            
    return render(request, 'library/add_user.html')






<a href="{% url 'add_user' %}" class="btn btn-primary py-3 mb-2 shadow-sm"><i class="fas fa-user-plus me-2"></i> إضافة طالب أو دكتور جديد</a>







    path('add-user/', views.add_user_view, name='add_user'),
